<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Job Work Dashboard</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="styles.css">
</head>
<body>
<header>
  <div class="wrap topbar">
    <div class="brand">
      <div class="logo">JW</div>
      <div>
        <div style="font-weight:var(--font-weight-bold);font-size:17px;letter-spacing:-0.02em">Work Dashboard</div>
        <div class="tiny muted" style="font-weight:var(--font-weight-medium);opacity:0.8">Beautifully organized</div>
      </div>
    </div>
    <div class="tabs" id="tabs">
      <button class="tab active" data-tab="todos">Todos</button>
      <button class="tab" data-tab="projects">Projects</button>
      <button class="tab" data-tab="people">People</button>
      <button class="tab" data-tab="kanban">Kanban</button>
      <button class="tab" data-tab="canvas">Canvas</button>
    </div>
    <div class="rightbar">
      <input type="file" id="fileImport" accept="application/json" class="hidden">
    </div>
  </div>
</header>

<!-- Universal Filter Bar -->
<div class="wrap" style="padding-top:8px;padding-bottom:0">
  <div class="universal-filters">
    <div class="filter-group">
      <label>Search</label>
      <input type="text" id="globalSearch" placeholder="Search anything‚Ä¶">
    </div>
    <div class="filter-group">
      <label>Project</label>
      <select id="globalProject">
        <option value="">All projects</option>
      </select>
    </div>
    <div class="filter-group">
      <label>Person</label>
      <select id="globalPerson">
        <option value="">All people</option>
      </select>
    </div>
    <div class="filter-group">
      <label>Status</label>
      <select id="globalStatus">
        <option value="">Any status</option>
        <option value="todo">Todo</option>
        <option value="in-progress">In Progress</option>
        <option value="waiting">Waiting</option>
        <option value="review">Review</option>
        <option value="done">Done</option>
      </select>
    </div>
    <div class="filter-group">
      <label class="checkbox-label">
        <input type="checkbox" id="globalDueToday">
        <span>Due Today</span>
      </label>
    </div>
    <div class="filter-group">
      <label class="checkbox-label">
        <input type="checkbox" id="globalOverdue">
        <span>Overdue</span>
      </label>
    </div>
    <div class="filter-group">
      <label class="checkbox-label">
        <input type="checkbox" id="globalShowArchived">
        <span>Show Archived</span>
      </label>
    </div>
    <button class="pill" id="btnClearFilters" title="Clear all filters"><i class="fas fa-times"></i> Clear</button>
  </div>
</div>

<main class="wrap">
  <!-- TODOS -->
  <section id="view-todos" class="panel">
    <div class="filters">
      <div><label>Sort</label>
        <select id="fSort">
          <option value="created-desc">Created ‚Üì</option>
          <option value="due-asc">Due ‚Üë</option>
          <option value="due-desc">Due ‚Üì</option>
          <option value="priority-desc">Priority (HIU) ‚Üì</option>
          <option value="priority-asc">Priority (HIU) ‚Üë</option>
          <option value="duration-asc">Duration ‚Üë</option>
          <option value="duration-desc">Duration ‚Üì</option>
          <option value="status-asc">Status A‚ÜíZ</option>
          <option value="project-asc">Project A‚ÜíZ</option>
          <option value="project-desc">Project Z‚ÜíA</option>
          <option value="title-asc">Title A‚ÜíZ</option>
        </select>
      </div>
      <div><label>Group by</label>
        <select id="fGroup">
          <option value="">No grouping</option>
          <option value="project">Project</option>
          <option value="status">Status</option>
          <option value="person">Person</option>
          <option value="due">Due date</option>
        </select>
      </div>
    </div>
    <div class="toolbar"><span class="note" id="countInfo"></span></div>
    <div class="list-todos" id="todoList"></div>
    <!-- Hidden button for context menu -->
    <div style="display:none;"><button id="btnCreateCanvasFromTodos"></button></div>
  </section>

  <!-- PROJECTS -->
  <section id="view-projects" class="panel hidden">
    <div class="filters">
      <div><label>Sort</label>
        <select id="prSort">
          <option value="todos-desc">Most todos first</option>
          <option value="todos-asc">Fewest todos first</option>
          <option value="name-asc">Name A‚ÜíZ</option>
          <option value="name-desc">Name Z‚ÜíA</option>
        </select>
      </div>
    </div>
    <div class="toolbar"><span class="note" id="projectCountInfo"></span></div>
    <div class="list" id="projectList"></div>
    <!-- Hidden buttons for context menu -->
    <div style="display:none;">
      <button id="btnAddProject"></button>
      <button id="btnExpandAllProjects"></button>
      <button id="btnCollapseAllProjects"></button>
    </div>
  </section>

  <!-- PEOPLE -->
  <section id="view-people" class="panel hidden">
    <div class="filters">
      <div><label>Sort</label>
        <select id="pSort">
          <option value="tasks-desc">Most tasks first</option>
          <option value="tasks-asc">Fewest tasks first</option>
          <option value="waiting-me-desc">Waiting on them ‚Üì</option>
          <option value="waiting-them-desc">Waiting on me ‚Üì</option>
          <option value="name-asc">Name A‚ÜíZ</option>
          <option value="name-desc">Name Z‚ÜíA</option>
        </select>
      </div>
      <div><label>Group by</label>
        <select id="pGroup">
          <option value="">No grouping</option>
          <option value="project">Project</option>
        </select>
      </div>
    </div>
    <div class="toolbar"><span class="note" id="peopleCountInfo"></span></div>
    <div class="list" id="peopleList"></div>
    <!-- Hidden button for context menu -->
    <div style="display:none;"><button id="btnAddPerson"></button></div>
  </section>

  <!-- KANBAN -->
  <section id="view-kanban" class="panel hidden">
    <div class="toolbar kanban-toolbar">
      <div class="kanban-toolbar-group">
        <div class="kanban-control">
          <label class="tiny muted">Board</label>
          <select id="kbSelect"></select>
        </div>
      </div>
      <div class="kanban-toolbar-group">
        <div class="kanban-control">
          <label class="tiny muted">Project</label>
          <select id="kbProject"><option value="">All</option></select>
        </div>
      </div>
    </div>
    <div class="grid-boards" id="kanbanGrid"></div>
    <!-- Hidden buttons for context menu -->
    <div style="display:none;">
      <button id="btnAddBoard"></button>
      <button id="btnEditBoard"></button>
    </div>
  </section>

  <!-- CANVAS -->
  <section id="view-canvas" class="hidden" style="padding:0;margin:0;border:none;background:none;">
    <div id="canvasContainer" style="position:relative;width:100%;height:calc(100vh - 80px);border-radius:0;box-shadow:none;padding:0;margin:0;background:var(--bg-secondary);border:none;">
      <canvas id="mainCanvas" width="1200" height="800" style="display:block;width:100%;height:100%;background:radial-gradient(circle at 20px 20px, var(--muted) 1px, transparent 1px);background-size:40px 40px;"></canvas>
      <div class="canvas-viewport" id="canvasViewport"></div>
      <div class="canvas-toolbar-floating" style="position:absolute;top:24px;right:24px;z-index:10;display:flex;gap:8px;align-items:center;border-radius:12px;box-shadow:var(--shadow-medium);padding:8px 12px;background:var(--panel);">
        <select id="canvasViewSelect" style="font-size:13px;">
          <option value="default">Default Canvas</option>
        </select>
        <button class="iconbtn" id="btnCanvasFullscreen" title="Toggle fullscreen"><i class="fas fa-expand"></i></button>
      </div>
      <!-- Hidden buttons for context menu actions -->
      <div style="display:none;">
        <button id="btnAddCanvasView"></button>
        <button id="btnDeleteCanvasView"></button>
        <button id="btnAddTodoToCanvas"></button>
        <button id="btnAddProjectToCanvas"></button>
        <button id="btnAddAllTodos"></button>
        <button id="btnArrangeEntities"></button>
        <button id="btnFitToContent"></button>
        <button id="btnCanvasReset"></button>
      </div>
    </div>
  </section>
</main>

<button class="fab" id="fabAdd" title="Add todo"><i class="fas fa-plus"></i></button>

<!-- MODAL: ADD/EDIT TODO -->
<dialog id="dlgTodo">
  <form method="dialog" class="modal" id="todoForm">
    <h3 id="todoFormTitle">New Todo</h3>
    <div class="row">
      <div><label>Title</label><input type="text" id="tTitle" required></div>
      <div><label>Project</label><select id="tProject"></select></div>
    </div>
    <div class="row">
      <div><label>Due date</label><input type="date" id="tDue"></div>
      <div><label>Status</label><select id="tStatus">
        <option value="todo">Todo</option><option value="in-progress">In Progress</option>
        <option value="waiting">Waiting</option><option value="review">Review</option>
        <option value="done">Done</option></select></div>
    </div>
    <div class="row">
      <div>
        <label>Estimated duration</label>
        <div class="duration-input">
          <input type="number" id="tDurationValue" min="0" step="0.25" placeholder="0">
          <select id="tDurationUnit">
            <option value="minutes">minutes</option>
            <option value="hours">hours</option>
            <option value="days">days</option>
          </select>
        </div>
        <div class="tiny muted" style="margin-top:4px">Used for scheduling and sorting; leave blank to skip.</div>
      </div>
      <div></div>
    </div>
    <div>
      <label>Eisenhower (H/I/U)</label>
      <div class="hiu" id="eisenForm">
        <span class="d h" data-k="impact" title="High impact"></span>
        <span class="d i" data-k="important" title="Important"></span>
        <span class="d u" data-k="urgent" title="Urgent"></span>
      </div>
    </div>
    <div><label>Tags (comma separated)</label><input type="text" id="tTags" placeholder="design, api, review"></div>
    <div><label>Notes</label><textarea id="tNotes" rows="3" placeholder="Optional details‚Ä¶"></textarea></div>
    <div class="row">
      <div><label>I'm waiting on‚Ä¶ (multi-select)</label><select id="selWaitingOn" multiple size="6"></select>
        <div class="tiny muted" style="margin-top:4px">üí° Ctrl+click to deselect items ¬∑ <button type="button" id="btnClearWaitingOn" style="background:none;border:none;color:var(--acc);cursor:pointer;font-size:11px">Clear all</button></div></div>
      <div><label>They're waiting on me‚Ä¶ (multi-select)</label><select id="selWaitingOnMe" multiple size="6"></select>
        <div class="tiny muted" style="margin-top:4px">üí° Ctrl+click to deselect items ¬∑ <button type="button" id="btnClearWaitingOnMe" style="background:none;border:none;color:var(--acc);cursor:pointer;font-size:11px">Clear all</button></div></div>
    </div>
    <div class="toolbar" style="justify-content:space-between;background:transparent;padding:0;margin-top:20px">
      <div style="display:flex;gap:8px">
        <button id="btnArchiveTodo" type="button" class="pill" style="background:#6c757d;color:#fff;border-color:transparent;"><i class="fas fa-archive"></i> Archive</button>
        <button id="btnUnarchiveTodo" type="button" class="pill" style="background:#30d158;color:#fff;border-color:transparent;display:none"><i class="fas fa-undo"></i> Unarchive</button>
        <button id="btnDeleteTodo" type="button" class="pill" style="background:#ff3b30;color:#fff;border-color:transparent;display:none"><i class="fas fa-trash"></i> Delete</button>
      </div>
      <div style="display:flex;gap:8px">
        <button value="cancel" class="pill">Cancel</button>
        <button id="btnSaveTodo" value="default" class="pill action">Save</button>
      </div>
    </div>
    <input type="hidden" id="tId">
  </form>
</dialog>

<!-- MODAL: ADD PROJECT -->
<dialog id="dlgProject">
  <form method="dialog" class="modal" id="projectForm">
    <h3>New Project</h3>
    <div class="row">
      <div><label>Name</label><input type="text" id="pName" required></div>
      <div><label>Color</label><input type="color" id="pColor" value="#7cc9ff"></div>
    </div>
    <div class="toolbar" style="justify-content:flex-end">
      <button value="cancel" class="pill">Cancel</button>
      <button id="btnSaveProject" value="default" class="pill action">Save</button>
    </div>
  </form>
</dialog>

<!-- MODAL: ADD PERSON -->
<dialog id="dlgPerson">
  <form method="dialog" class="modal" id="personForm">
    <h3>New Person</h3>
    <div class="row">
      <div><label>Name</label><input type="text" id="sName" required></div>
      <div><label>Initials</label><input type="text" id="sInit" placeholder="AB" maxlength="3"></div>
    </div>
    <div><label>Projects</label>
      <div id="sProjects" class="checkbox-group"></div>
    </div>
    <div class="toolbar" style="justify-content:flex-end">
      <button value="cancel" class="pill">Cancel</button>
      <button id="btnSavePerson" value="default" class="pill action">Save</button>
    </div>
  </form>
</dialog>

<!-- MODAL: ATTACH EXISTING TASKS -->
<dialog id="dlgAttach">
  <form method="dialog" class="modal" id="attachForm">
    <h3 id="attachTitle">Attach tasks</h3>
    <div class="filters">
      <div><label>Search</label><input type="text" id="aSearch" placeholder="Search anything‚Ä¶"></div>
      <div><label>Project</label><select id="aProject"><option value="">All projects</option></select></div>
      <div><label>Person</label><select id="aPerson"><option value="">All people</option></select></div>
      <div><label>Status</label><select id="aStatus"><option value="">Any</option><option value="todo">Todo</option><option value="in-progress">In Progress</option><option value="waiting">Waiting</option><option value="review">Review</option><option value="done">Done</option></select></div>
    </div>
    <div class="toolbar">
      <div><label class="tiny muted">Sort by</label>
        <select id="aSort">
          <option value="due-asc">Due ‚Üë</option><option value="due-desc">Due ‚Üì</option>
          <option value="priority-desc">Priority ‚Üì</option><option value="priority-asc">Priority ‚Üë</option>
          <option value="duration-asc">Duration ‚Üë</option><option value="duration-desc">Duration ‚Üì</option>
          <option value="created-desc">Created ‚Üì</option><option value="title-asc">Title A‚ÜíZ</option>
        </select>
      </div>
      <span class="note" id="aCount"></span>
    </div>
    <div class="list-todos" id="attachList"></div>
    <div class="toolbar" style="justify-content:flex-end">
      <button value="cancel" class="pill">Cancel</button>
      <button id="btnAttachConfirm" value="default" class="pill action">Attach</button>
    </div>
  </form>
</dialog>

<!-- MODAL: EDIT BOARD (rename + custom columns) -->
<dialog id="dlgBoard">
  <form method="dialog" class="modal" id="boardForm">
    <h3>Edit Board</h3>
    <div><label>Name</label><input type="text" id="bName"></div>
    <div style="margin-top:8px">
      <label>Columns</label>
      <div id="bCols"></div>
      <div class="toolbar"><button class="pill action" id="btnAddCol" type="button">Add column</button></div>
    </div>
    <div class="toolbar" style="justify-content:flex-end">
      <button value="cancel" class="pill">Cancel</button>
      <button id="btnSaveBoard" value="default" class="pill action">Save</button>
    </div>
  </form>
</dialog>

<!-- MODAL: DELETE PROJECT -->
<dialog id="dlgDeleteProject">
  <form method="dialog" class="modal" id="deleteProjectForm">
    <h3>Delete Project</h3>
    <div style="margin-bottom:16px">
      <div style="padding:12px;background:color-mix(in oklab,var(--warn) 10%,transparent);border:1px solid color-mix(in oklab,var(--warn) 30%,transparent);border-radius:12px;margin-bottom:12px">
        <strong>‚ö†Ô∏è Warning:</strong> You are about to delete "<span id="deleteProjectName"></span>".
      </div>
      <p style="margin:8px 0">What should happen to the <strong><span id="deleteTodoCount"></span></strong> assigned to this project?</p>
      
      <div style="margin:12px 0">
        <label style="display:flex;align-items:center;gap:8px;cursor:pointer">
          <input type="radio" name="deleteMode" value="unassign" checked>
          <span><strong>Unassign todos</strong> (recommended)<br><small class="muted">Todos will remain but be unassigned from this project</small></span>
        </label>
      </div>
      
      <div style="margin:12px 0">
        <label style="display:flex;align-items:center;gap:8px;cursor:pointer">
          <input type="radio" name="deleteMode" value="reassign" id="reassignRadio">
          <span><strong>Reassign to another project</strong><br><small class="muted">Move all todos to a different project</small></span>
        </label>
        <div style="margin-top:8px;margin-left:32px" id="reassignProjectContainer">
          <select id="reassignProjectSelect" style="width:100%" disabled>
            <option value="">Select target project...</option>
          </select>
        </div>
      </div>
      
      <!-- Collapsible dangerous option -->
      <details style="margin-top:16px">
        <summary style="cursor:pointer;color:var(--bad);font-size:12px;padding:4px 0">‚ö†Ô∏è Show destructive option</summary>
        <div style="margin-top:8px;padding:12px;background:color-mix(in oklab,var(--bad) 8%,transparent);border:1px solid color-mix(in oklab,var(--bad) 30%,transparent);border-radius:8px">
          <label style="display:flex;align-items:center;gap:8px;cursor:pointer">
            <input type="radio" name="deleteMode" value="deleteTodos">
            <span style="color:var(--bad)"><strong>Delete all todos in this project</strong><br><small>‚ö†Ô∏è This action cannot be undone!</small></span>
          </label>
        </div>
      </details>
    </div>
    
    <div class="toolbar" style="justify-content:space-between">
      <button value="cancel" class="pill">Cancel</button>
      <button id="btnConfirmDeleteProject" value="default" class="pill" style="background:var(--bad);color:#fff;border-color:transparent">Delete Project</button>
    </div>
    <input type="hidden" id="deleteProjectId">
  </form>
</dialog>

<!-- COMMAND PALETTE -->
<div class="kbar" id="kbar" aria-hidden="true">
  <div class="kpanel">
    <div class="khead"><input id="kinput" placeholder="Type a command‚Ä¶ (e.g. new, go kanban, filter status:todo)"/></div>
    <div class="klist" id="klist"></div>
  </div>
</div>

<!-- CONTEXT MENUS -->
<div class="context-menu" id="contextMenu">
  <div class="context-menu-item" data-action="addTodo"><i class="fas fa-plus"></i> Add todo</div>
  <div class="context-menu-item" data-action="editProject"><i class="fas fa-pen"></i> Edit name</div>
  <div class="context-menu-item" data-action="expandAll"><i class="fas fa-chevron-down"></i> Expand all</div>
  <div class="context-menu-item" data-action="collapseAll"><i class="fas fa-chevron-up"></i> Collapse all</div>
  <div class="context-menu-divider"></div>
  <div class="context-menu-item danger" data-action="deleteProject"><i class="fas fa-trash"></i> Delete project</div>
</div>

<div class="context-menu" id="todoContextMenu">
  <div class="context-menu-item" data-action="editTodo"><i class="fas fa-pen"></i> Edit</div>
  <div class="context-menu-item" data-action="duplicateTodo"><i class="fas fa-copy"></i> Duplicate</div>
  <div class="context-menu-item" data-action="archiveTodo"><i class="fas fa-archive"></i> Archive</div>
  <div class="context-menu-divider"></div>
  <div class="context-menu-item danger" data-action="deleteTodo"><i class="fas fa-trash"></i> Delete</div>
</div>

<div class="context-menu" id="personContextMenu">
  <div class="context-menu-item" data-action="addTask"><i class="fas fa-plus"></i> Add task</div>
  <div class="context-menu-item" data-action="attachTask"><i class="fas fa-link"></i> Attach existing</div>
  <div class="context-menu-divider"></div>
  <div class="context-menu-item danger" data-action="deletePerson"><i class="fas fa-trash"></i> Delete person</div>
</div>

<div class="context-menu" id="kanbanContextMenu">
  <div class="context-menu-item" data-action="newBoard"><i class="fas fa-plus"></i> New board</div>
  <div class="context-menu-item" data-action="editBoard"><i class="fas fa-cog"></i> Edit board</div>
  <div class="context-menu-item" data-action="addColumn"><i class="fas fa-columns"></i> Add column</div>
  <div class="context-menu-divider"></div>
  <div class="context-menu-item danger" data-action="deleteBoard"><i class="fas fa-trash"></i> Delete board</div>
</div>

<div class="context-menu" id="canvasContextMenu">
  <div class="context-menu-item" data-action="addTodoToCanvas"><i class="fas fa-sticky-note"></i> Add todo</div>
  <div class="context-menu-item" data-action="addProjectToCanvas"><i class="fas fa-folder"></i> Add project</div>
  <div class="context-menu-item" data-action="addAllTodos"><i class="fas fa-list-check"></i> Add all todos</div>
  <div class="context-menu-divider"></div>
  <div class="context-menu-item" data-action="newCanvas"><i class="fas fa-plus"></i> New canvas</div>
  <div class="context-menu-item" data-action="arrangeEntities"><i class="fas fa-grip-vertical"></i> Auto-arrange</div>
  <div class="context-menu-item" data-action="fitToContent"><i class="fas fa-compress-arrows-alt"></i> Fit to content</div>
  <div class="context-menu-item" data-action="resetView"><i class="fas fa-home"></i> Reset view</div>
  <div class="context-menu-divider"></div>
  <div class="context-menu-item danger" data-action="deleteCanvas"><i class="fas fa-trash"></i> Delete canvas</div>
</div>

<div class="context-menu" id="listContextMenu">
  <div class="context-menu-item" data-action="addNew"><i class="fas fa-plus"></i> Add new</div>
  <div class="context-menu-item" data-action="createCanvas"><i class="fas fa-project-diagram"></i> Create canvas</div>
</div>

<script src="app.js"></script>
</body>
</html>
